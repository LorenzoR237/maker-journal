---
import BaseLayout from "../../layouts/BaseLayout.astro";

// Load every image under /src/images/<category>/<file>
const modules = import.meta.glob('/src/images/*/*.{jpg,JPG,jpeg,png,webp,avif}', { eager: true });

const items = Object.entries(modules).map(([path, mod]) => {
  // path: /src/images/<category>/<file>
  const parts = path.split('/');              // ["", "src", "images", "<category>", "<file>"]
  const category = parts[3].toLowerCase();    // nature | travel | street
  const img = (mod as any).default;           // { src, width, height }
  return { src: img.src, width: img.width, height: img.height, category, alt: `${category} photo` };
});

// Build tabs from categories (index shows “All”)
const categories = Array.from(new Set(items.map(i => i.category))).sort();
const toTitle = (s) => s.charAt(0).toUpperCase() + s.slice(1);
---

<BaseLayout title="Photos — All" description="All photos">
  <section class="ph-wrap">
    <!-- Tabs as LINKS -->
    <div class="ph-tabs" role="tablist" aria-label="Photo categories">
      <a class="ph-tab is-active" role="tab" aria-selected="true" href="/photos">All</a>
      {categories.map((c) => (
        <a class="ph-tab" role="tab" aria-selected="false" href={`/photos/${c}`}>{toTitle(c)}</a>
      ))}
    </div>

    <!-- Grid -->
    <div class="ph-grid">
      {items.map((it) => (
        <figure class="ph-card" data-category={it.category}>
          <a href={it.src} data-fancybox="gallery">
            <img src={it.src} alt={it.alt} loading="lazy" width={it.width} height={it.height} />
          </a>
        </figure>
      ))}
    </div>
  </section>

  <style>
    .ph-wrap { max-width: 1200px; margin: 0 auto; padding: 16px; }
    .ph-tabs { display:flex; gap:8px; flex-wrap:wrap; margin:0 0 16px; }
    .ph-tab {
      display:inline-block; padding:8px 12px; border-radius:999px;
      border:1px solid #ddd; text-decoration:none; color:#333; background:#fff;
    }
    .ph-tab.is-active, .ph-tab:focus { border-color:#333; outline:none; }
    .ph-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:12px; }
    .ph-card { border-radius:8px; overflow:hidden; background:#f7f7f7; }
    .ph-card img { width:100%; height:100%; object-fit:cover; display:block; }
    @media (prefers-color-scheme: dark) {
      .ph-tab { border-color:#333; background:#111; color:#ddd; }
      .ph-card { background:#111; }
    }
  </style>
</BaseLayout>
